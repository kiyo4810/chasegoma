<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>ã‚´ãƒã¡ã‚ƒã‚“ã‚’è¿½ãˆ</title>
    <style>
      /* ã“ã“ã¯ CSSï¼ˆãƒ‡ã‚¶ã‚¤ãƒ³ï¼‰ã®éƒ¨å±‹ */
      body {
        margin: 0;
        overflow: hidden; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ãŒå‡ºãªã„ã‚ˆã†ã«ã™ã‚‹ */
      }
      canvas {
        display: block; /* éš™é–“ãªãè¡¨ç¤ºã™ã‚‹ */
      }
      /* éŸ³é‡ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®è¦‹ãŸç›®ï¼ˆç›®æ¨™ã‚³ãƒ¼ãƒ‰ã®å†ç¾ï¼‰ */
      #volume-container {
        position: absolute; /* ç”»é¢ã®æ±ºã¾ã£ãŸå ´æ‰€ã«æµ®ã‹ã›ã‚‹ */
        top: 20px;
        left: 20px;
        z-index: 1000; /* ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚ˆã‚Šæ‰‹å‰ã«è¡¨ç¤º */
        background: rgba(255, 255, 255, 0.1); /* åŠé€æ˜ã®ç™½ */
        padding: 15px;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        cursor: move; /* ã€Œã¤ã‹ã‚ã‚‹ã‚ˆã€ã¨ã„ã†ãƒã‚¦ã‚¹ã®å½¢ */
        backdrop-filter: blur(8px); /* èƒŒæ™¯ã‚’ã¼ã‹ã™ãŠã—ã‚ƒã‚Œæ©Ÿèƒ½ */
        -webkit-backdrop-filter: blur(8px);
      }

      .volume-label {
        color: white;
        font-family: sans-serif;
        pointer-events: none; /* æ–‡å­—ã¯ã‚¯ãƒªãƒƒã‚¯ã®é‚ªé­”ã‚’ã—ãªã„ã‚ˆã†ã« */
      }
    </style>
  </head>
  <body>
    <div id="volume-container">
      <div class="volume-label">ğŸ”Š <span id="volumeValue">70</span>%</div>
      <input type="range" id="volumeSlider" min="0" max="100" value="70" />
    </div>
    <canvas id="gameCanvas"></canvas>

    <script>
      /* ã“ã“ã¯ JavaScriptï¼ˆå‘½ä»¤ï¼‰ã®éƒ¨å±‹ */
      // let isGameStarted = false; // ã¾ã å§‹ã¾ã£ã¦ã„ãªã„ã¨ã„ã†ã€Œç›®å°ã€
      let isGameStarted = false;
      // 1. ç”»ç”¨ç´™ã‚’æ•ã¾ãˆã‚‹
      //   const canvas = document.getElementById("gameCanvas");
      const canvas = document.getElementById("gameCanvas");
      console.log(canvas);

      // 2. ãƒšãƒ³ã‚’å–ã‚Šå‡ºã™
      //const ctx = canvas.getContext("2d");
      const ctx = canvas.getContext("2d");
      //       console.log(ctx);
      // /* ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä¸Šã®ã»ã†ï¼ˆcanvasã®å®šç¾©ã®ä¸‹ã‚ãŸã‚Šï¼‰ã«è¿½åŠ  */
      // let spriteX = 0;      // æ¨ªã®ä½ç½®
      // let spriteY = 0;      // ç¸¦ã®ä½ç½®
      // let vx = 2;           // æ¨ªã®ã‚¹ãƒ”ãƒ¼ãƒ‰ï¼ˆ1ãƒ•ãƒ¬ãƒ¼ãƒ ã«ä½•ãƒ”ã‚¯ã‚»ãƒ«é€²ã‚€ã‹ï¼‰
      // let vy = 2;           // ç¸¦ã®ã‚¹ãƒ”ãƒ¼ãƒ‰
      // const size = 200;     // ã‚´ãƒã¡ã‚ƒã‚“ã®ã‚µã‚¤ã‚º
      let spriteX = 0;
      let spriteY = 0;
      let vx = 2;
      let vy = 2;
      const size = 200;
      let score = 0; // ã‚¹ã‚³ã‚¢ï¼ˆæœ€åˆã¯0ç‚¹ï¼‰
      // function loop() {
      //   // 1. è¨ˆç®—ï¼šä½ç½®ã‚’ã‚¹ãƒ”ãƒ¼ãƒ‰åˆ†ã ã‘é€²ã‚ã‚‹
      //   spriteX += vx;
      //   spriteY += vy;

      //   // 2. è·³ã­è¿”ã‚Šï¼šå£ã«ã¶ã¤ã‹ã£ãŸã‚‰ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚’é€†è»¢ã•ã›ã‚‹
      //   if (spriteX < 0 || spriteX > canvas.width - size) {
      //     vx *= -1; // æ¨ªæ–¹å‘ã‚’åå¯¾ã«
      //   }
      //   if (spriteY < 0 || spriteY > canvas.height - size) {
      //     vy *= -1; // ç¸¦æ–¹å‘ã‚’åå¯¾ã«
      //   }
      //   // 3. æç”»ï¼šå‰ã®çµµã‚’æ¶ˆã—ã¦ã€æ–°ã—ã„ä½ç½®ã«æãç›´ã™
      //   drawBackground(); // ç´ºè‰²ã§å¡—ã‚Šã¤ã¶ã™ï¼ˆã“ã‚Œã§å‰ã®ã‚´ãƒã¡ã‚ƒã‚“ãŒæ¶ˆãˆã‚‹ï¼‰
      //   ctx.drawImage(spriteImage, spriteX, spriteY, size, size);
      //   // 4. æ¬¡ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’äºˆç´„ã™ã‚‹ï¼ˆ1/60ç§’å¾Œã«ã¾ãŸloopã‚’å‘¼ã¶ï¼‰
      //   requestAnimationFrame(loop);
      // }
      function loop() {
        if (isGameStarted) {
          spriteX += vx;
          spriteY += vy;
          if (spriteX < 0 || spriteX > canvas.width - size) {
            vx *= -1;
          }
          if (spriteY < 0 || spriteY > canvas.height - size) {
            vy *= -1;
          }
        }

        drawBackground();
        if (!isGameStarted) {
          // å§‹ã¾ã£ã¦ã„ãªã„æ™‚ã¯ã€ç”»é¢ä¸­å¤®ã«ã€Œã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚¹ã‚¿ãƒ¼ãƒˆã€ã¨å‡ºã™
          ctx.fillStyle = "white";
          ctx.textAlign = "center";
          ctx.fillText(
            "ç”»é¢ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚¹ã‚¿ãƒ¼ãƒˆï¼",
            canvas.width / 2,
            canvas.height / 2 + 100
          );
        }
        ctx.drawImage(spriteImage, spriteX, spriteY, size, size);
        requestAnimationFrame(loop);
        /* loopé–¢æ•°ã®ä¸­ã€ctx.drawImage ã®ã™ãä¸‹ã«è¿½åŠ  */
        // ctx.fillStyle = "white"; // æ–‡å­—ã®è‰²ã‚’ç™½ã«ã™ã‚‹
        // ctx.font = "bold 30px Arial"; // å¤ªã•ã¨ã‚µã‚¤ã‚ºã¨ãƒ•ã‚©ãƒ³ãƒˆã‚’æ±ºã‚ã‚‹
        // ctx.fillText("Score: " + score, 20, 50); // å·¦ä¸Šã®ã»ã†ã«è¡¨ç¤ºã™ã‚‹
        ctx.fillStyle = "white";
        ctx.font = "bold 30px Arial";
        ctx.fillText("Score: " + score, 20, 50);
      }
      const spriteImage = new Image();
      spriteImage.src = "images/goma.png";
      spriteImage.onload = () => {
        const x = canvas.width / 2 - size / 2;
        const y = canvas.height / 2 - size / 2;
        loop();
      };
      const catSound = new Audio("images/cat.mp3");
      const specialSound = new Audio("images/special.mp3");
      // 3. ç”»ç”¨ç´™ã®ã‚µã‚¤ã‚ºã‚’ç”»é¢ã„ã£ã±ã„ã«è¨­å®šã™ã‚‹
      //   function resize() {
      //     canvas.width = window.innerWidth;
      //     canvas.height = window.innerHeight;
      //     console.log(canvas.width);
      //     console.log(canvas.height);
      //     drawBackground();
      //  }
      function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        drawBackground();
      }
      /* resizeé–¢æ•°ã®ä¸‹ã‚ãŸã‚Šã«ã§ã‚‚è¿½åŠ  */
      // å‰ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ä½œã£ãŸã€ŒéŸ³ã‚’é³´ã‚‰ã™é–¢æ•°ã€ã‚’å°‘ã—æ”¹é€ 
      function playSuccessSound() {
        let targetSound =
          score > 0 && score % 10 === 0 ? specialSound : catSound;

        // â˜… ã“ã“ã§ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®å€¤ã‚’åæ˜ ã•ã›ã‚‹ï¼ˆ0.0ã€œ1.0ã«ã™ã‚‹ãŸã‚ã«100ã§å‰²ã‚‹ï¼‰
        targetSound.volume = volume / 100;

        targetSound.currentTime = 0;
        targetSound.play().catch(() => {});
      }

      // 4. ç´ºè‰²ã§å¡—ã‚Šã¤ã¶ã™é–¢æ•°
      //function drawBackground() {
      // ctx.fillStyle = "#0a0a32";
      // ctx.fillRect(0, 0, canvas.width, canvas.height);
      // }
      function drawBackground() {
        ctx.fillStyle = "#0a0a32";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
      }
      // ã“ã‚Œã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ï¼ˆwindowï¼‰ã«å¯¾ã—ã¦ã€ã€Œã€ãƒªã‚µã‚¤ã‚ºï¼ˆresizeï¼‰ã€ã¨ã„ã†å‡ºæ¥äº‹ãŒèµ·ããŸã‚‰ã€
      // å¾Œã‚ã«æ›¸ã„ã¦ã‚ã‚‹ã€resizeã€ã¨ã„ã†åå‰ã®é–¢æ•°ï¼ˆå‘½ä»¤ã‚»ãƒƒãƒˆï¼‰ã‚’å®Ÿè¡Œã—ã¦ã­ï¼ã€
      // ã¨ã„ã†äºˆç´„ã‚’å…¥ã‚Œã¦ã„ã‚‹çŠ¶æ…‹ã§ã™ã€‚
      // addEventListener: ã€Œè€³ã‚’ã™ã¾ã›ã¦å¾…æ©Ÿã›ã‚ˆã€ã¨ã„ã†å‘½ä»¤ã§ã™ã€‚
      // "resize": å¾…ã¡æ§‹ãˆã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã®ç¨®é¡ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®å¹…ã‚„é«˜ã•ãŒå¤‰ã‚ã£ãŸç¬é–“ã®ã“ã¨ã§ã™ã€‚
      // resizeï¼ˆå¾Œã‚ã®æ–¹ï¼‰: å®Ÿè¡Œã—ã¦ã»ã—ã„é–¢æ•°ã®åå‰ã€‚
      window.addEventListener("resize", resize);
      // ãƒã‚¦ã‚¹ãŒæŠ¼ã•ã‚ŒãŸæ™‚ã®å‡¦ç†
      canvas.addEventListener("mousedown", (e) => {
        if (!isGameStarted) {
          isGameStarted = true; // æœ€åˆã®ã‚¯ãƒªãƒƒã‚¯ã§ã‚²ãƒ¼ãƒ é–‹å§‹ï¼
          return; // æœ€åˆã®ã‚¯ãƒªãƒƒã‚¯ã§ã¯ã‚¹ã‚³ã‚¢ã¯å¢—ã‚„ã•ãªã„
        }
        // 1. ã‚´ãƒã¡ã‚ƒã‚“ã®ä¸­å¿ƒï¼ˆãŠã¸ãï¼‰ã®å ´æ‰€ã‚’è¨ˆç®—
        const centerX = spriteX + size / 2;
        const centerY = spriteY + size / 2;

        // 2. ãƒã‚¦ã‚¹ã®å ´æ‰€(e.clientX, e.clientY)ã¨ã€ä¸­å¿ƒã®è·é›¢ã‚’æ¸¬ã‚‹
        // Aã®2ä¹— + Bã®2ä¹— = Cã®2ä¹— ã®ãƒ«ãƒ¼ãƒˆï¼
        const diffX = e.clientX - centerX;
        const diffY = e.clientY - centerY;
        const dist = Math.sqrt(Math.pow(diffX, 2) + Math.pow(diffY, 2));

        // 3. ã‚‚ã—è·é›¢ãŒã‚´ãƒã¡ã‚ƒã‚“ã®åŠå¾„ï¼ˆsize/2ï¼‰ã‚ˆã‚Šå°ã•ã‘ã‚Œã°ã€Œå½“ãŸã‚Šï¼ã€
        if (dist < size / 2) {
          score += 1; // ã‚¹ã‚³ã‚¢ã‚¢ãƒƒãƒ—ï¼
          // â˜… ã“ã“ã§è¿½åŠ ã—ãŸé–¢æ•°ã‚’å‘¼ã¶ï¼
          playSuccessSound();
          // ã‚´ãƒã¡ã‚ƒã‚“ã‚’åˆ¥ã®å ´æ‰€ã«ãƒ¯ãƒ¼ãƒ—ã•ã›ã‚‹ï¼ˆé€ƒã’ã‚‹ï¼ï¼‰
          spriteX = Math.random() * (canvas.width - size);
          spriteY = Math.random() * (canvas.height - size);

          // æ•ã¾ãˆã‚‹ãŸã³ã«å°‘ã—ãšã¤ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚’ä¸Šã’ã‚‹ï¼ˆã‚„ã‚ŠãŒã„ã‚¢ãƒƒãƒ—ï¼ï¼‰
          vx *= 1.1;
          vy *= 1.1;
        }
      });
      resize();

      // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®éƒ¨å“ã‚’æ•ã¾ãˆã‚‹
      const volumeSlider = document.getElementById("volumeSlider");
      const volumeValue = document.getElementById("volumeValue");
      /* è¿½åŠ ã™ã‚‹å ´æ‰€ï¼šconst volumeSlider = ... ã®ä¸Šã‚ãŸã‚Š */
      const volumeContainer = document.getElementById("volume-container");

      let volume = 70; // æœ€åˆã®éŸ³é‡ï¼ˆ70%ï¼‰

      // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’å‹•ã‹ã—ãŸæ™‚ã«å®Ÿè¡Œã™ã‚‹äºˆç´„
      volumeSlider.addEventListener("input", (e) => {
        volume = parseInt(e.target.value); // æ•°å­—ã¨ã—ã¦èª­ã¿å–ã‚‹
        volumeValue.textContent = volume; // ç”»é¢ã®æ•°å­—ã‚’æ›¸ãæ›ãˆã‚‹
      });

      // --- éŸ³é‡ãƒ‘ãƒãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã§ç§»å‹•ã•ã›ã‚‹ä»•çµ„ã¿ ---
      let isDragging = false; // ãƒ‘ãƒãƒ«ã‚’ã¤ã‹ã‚“ã§ã„ã‚‹ã‹ã©ã†ã‹ã®ç›®å°
      let offset = { x: 0, y: 0 }; // ã¤ã‹ã‚“ã ä½ç½®ã¨ãƒ‘ãƒãƒ«ã®å·¦ä¸Šã®ã€Œã‚ºãƒ¬ã€ã‚’è¨˜éŒ²

      const startDrag = (e) => {
        // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼æœ¬ä½“ã‚’è§¦ã£ã¦ã„ã‚‹ã¨ãã¯ã€ãƒ‘ãƒãƒ«ç§»å‹•ã¯ã•ã›ãªã„
        if (e.target === volumeSlider) return;

        isDragging = true;
        // ãƒã‚¦ã‚¹ã‹ã‚¿ãƒƒãƒï¼ˆæŒ‡ï¼‰ã‹ã€ä¸¡æ–¹ã‹ã‚‰åº§æ¨™ã‚’å–å¾—ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;

        // ã¤ã‹ã‚“ã ç¬é–“ã®ã€ãƒ‘ãƒãƒ«ã®å·¦ä¸Šã‹ã‚‰ã®è·é›¢ã‚’æ¸¬ã£ã¦ãŠãï¼ˆã“ã‚ŒãŒãªã„ã¨ãƒ‘ãƒãƒ«ãŒé£›ã³ã¾ã™ï¼‰
        offset.x = clientX - volumeContainer.offsetLeft;
        offset.y = clientY - volumeContainer.offsetTop;
      };

      const doDrag = (e) => {
        if (!isDragging) return; // ã¤ã‹ã‚“ã§ã„ãªã‘ã‚Œã°ä½•ã‚‚ã—ãªã„

        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;

        // ãƒ‘ãƒãƒ«ã®æ–°ã—ã„ä½ç½®ã‚’è¨ˆç®—ï¼ˆç”»é¢ã®å¤–ã«å‡ºãªã„ã‚ˆã†ã« Math.max ã¨ Math.min ã§åˆ¶é™ï¼‰
        const newX = Math.max(
          0,
          Math.min(
            window.innerWidth - volumeContainer.offsetWidth,
            clientX - offset.x
          )
        );
        const newY = Math.max(
          0,
          Math.min(
            window.innerHeight - volumeContainer.offsetHeight,
            clientY - offset.y
          )
        );

        volumeContainer.style.left = newX + "px";
        volumeContainer.style.top = newY + "px";
      };

      // ã‚¤ãƒ™ãƒ³ãƒˆã®ç™»éŒ²ï¼ˆãƒã‚¦ã‚¹ã¨ã‚¿ãƒƒãƒã®ä¸¡æ–¹ã«å¯¾å¿œï¼‰
      volumeContainer.addEventListener("mousedown", startDrag);
      window.addEventListener("mousemove", doDrag);
      window.addEventListener("mouseup", () => (isDragging = false));

      // ã‚¹ãƒãƒ›ç”¨
      volumeContainer.addEventListener("touchstart", startDrag);
      window.addEventListener("touchmove", doDrag);
      window.addEventListener("touchend", () => (isDragging = false));
    </script>
  </body>
</html>
